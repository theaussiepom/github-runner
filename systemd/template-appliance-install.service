[Unit]
Description=template-appliance one-time installer
Wants=network-online.target
After=network-online.target

# Never re-run once successful.
ConditionPathExists=!/var/lib/template-appliance/installed

# Avoid systemd start-rate limiting while retrying.
StartLimitIntervalSec=0

[Service]
Type=oneshot
EnvironmentFile=-/etc/template-appliance/config.env

# Bootstrap is responsible for acquiring the installer and executing it.
ExecStart=/usr/local/lib/template-appliance/bootstrap.sh

# Retry until network is available and installation succeeds.
Restart=on-failure
RestartSec=30

[Install]
WantedBy=multi-user.target
